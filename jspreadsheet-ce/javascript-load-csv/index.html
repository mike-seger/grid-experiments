<html>
<head>
    <!-- 
    <link rel="stylesheet" href="https://jsuites.net/v4/jsuites.css" type="text/css" />
    <script src="https://bossanova.uk/jspreadsheet/v4/jexcel.js"></script>
    -->

    <!-- <link rel="stylesheet" href="jexcel.css" type="text/css" /> -->
    <link rel="stylesheet" href="https://bossanova.uk/jspreadsheet/v4/jexcel.css" type="text/css" /> 

    <script src="https://jsuites.net/v4/jsuites.js"></script>

    <!-- <script src="https://bossanova.uk/jspreadsheet/v4/jexcel.js"></script> -->
    <script type="text/javascript" src="jexcel.js"></script>
    <style>
        body, html {
            width: 99%;
            height: 100%;
            overflow: hidden;
        }
        #spreadsheet1 {
            width: 100%;
        }

        .dataGrid * {
            font-family: sans-serif;
            text-align: left !important; 
        }

        .dataSelector {
            margin: 6px 0 10px 0;
        }
    </style>

    <link rel="stylesheet" href="colors.css" type="text/css" />
</head>
<body>
    <select id="ds-selector" class="dataSelector">
        <option value="">select data source...</option>
        <option value="museums.csv">museums</option>
        <option value="citites.csv">cities</option>
        <option value="mlb_players.csv">mlb players</option>
    </select>

    <div id="spreadsheet1" class="dataGrid"></div>
    
    <p>
        <button id='save'>Save changes...</button>
        <button id='download'>Download CSV</button>
    </p>

    <script>
    function stringWidth(text) {
        const font = "bold 12pt arial"	
        const canvas = document.createElement("canvas");	
        const context = canvas.getContext("2d");	
        context.font = font;	
        const { width } = context.measureText(text);	
        return width;
    }

    var loaded = function(instance) {
        function findLongestString(arr) {
            return arr.reduce((a, b)=> a.length > b.length ? a : b);
        }
        console.log('New data is loaded');
        var js = instance.jspreadsheet;
        var nCols = js.colgroup.length;
        var colWidtths = [];
        for(var i = 0; i<nCols; i++) {
            var colData = js.getColumnData(i);
            var longestString = findLongestString(colData);
            colWidtths.push(stringWidth(longestString));
        }

        const pageW = instance.offsetWidth - 85;//pageDim.w-90;
        const sum = colWidtths.reduce((partialSum, a) => partialSum + a, 0);
        for(var i = 0; i<nCols; i++) {
            var w = colWidtths[i]/(1.0*sum)*pageW;
            js.setWidth(i, w);
        }
    }

    var theSpreadsheet;
    function selectDs(dataSource) {
        theSpreadsheet = 
            jspreadsheet(document.getElementById('spreadsheet1'), {
                csv:dataSource,
                csvHeaders:true,
                tableOverflow:true,
                tableWidth:'100%',
                tableHeight:'500px',
                width: '100%',
                onload: loaded,
            });
    }

    function save() {
        console.log("Save data...");
    }

    document.getElementById('ds-selector').onchange = function () { selectDs(this.value); }
    document.getElementById('save').onclick = function () { save(); }
    document.getElementById('download').onclick = function () { theSpreadsheet.download(); }
    </script>
</body>
</html>
